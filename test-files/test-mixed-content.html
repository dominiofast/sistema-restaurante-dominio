<!DOCTYPE html>
<html>
<head>
    <title>Teste Mixed Content - QZ Tray</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Teste de Mixed Content - QZ Tray</h1>
    <div id="info"></div>
    <div id="status"></div>
    <button onclick="testMixedContent()">Testar Mixed Content</button>
    <div id="logs"></div>

    <script>
        function log(message, color = 'black') {
            const logs = document.getElementById('logs');
            const p = document.createElement('p');
            p.innerHTML = new Date().toLocaleTimeString() + ': ' + message;
            p.style.color = color;
            logs.appendChild(p);
        }

        function showInfo() {
            const info = document.getElementById('info');
            const protocol = window.location.protocol;
            const host = window.location.host;
            
            info.innerHTML = `
                <h3>Informa√ß√µes da P√°gina:</h3>
                <p><strong>Protocolo:</strong> ${protocol}</p>
                <p><strong>Host:</strong> ${host}</p>
                <p><strong>URL Completa:</strong> ${window.location.href}</p>
                <p><strong>Mixed Content:</strong> ${protocol === 'https:' ? 'POSS√çVEL PROBLEMA' : 'OK (HTTP)'}</p>
            `;
        }

        function testMixedContent() {
            log('Iniciando teste de Mixed Content...');
            
            // Verificar protocolo
            const isHTTPS = window.location.protocol === 'https:';
            if (isHTTPS) {
                log('‚ö†Ô∏è P√°gina est√° em HTTPS - Mixed Content pode bloquear WebSocket HTTP', 'orange');
                log('üí° Solu√ß√£o: Configurar browser para permitir conte√∫do inseguro', 'blue');
            } else {
                log('‚úÖ P√°gina est√° em HTTP - Mixed Content n√£o √© problema', 'green');
            }

            // Testar fetch para porta 8181
            log('Testando conectividade HTTP para porta 8181...');
            fetch('http://localhost:8181')
                .then(response => {
                    log('‚úÖ Resposta HTTP recebida da porta 8181', 'green');
                })
                .catch(error => {
                    if (error.message.includes('Mixed Content')) {
                        log('‚ùå ERRO: Mixed Content bloqueou a requisi√ß√£o', 'red');
                        log('üí° Configure o browser para permitir conte√∫do inseguro', 'blue');
                    } else {
                        log('‚ö†Ô∏è Erro na requisi√ß√£o: ' + error.message, 'orange');
                    }
                });

            // Testar WebSocket
            log('Testando WebSocket para ws://localhost:8181...');
            try {
                const ws = new WebSocket('ws://localhost:8181');
                
                ws.onopen = function() {
                    log('‚úÖ WebSocket conectado com sucesso!', 'green');
                    ws.close();
                };
                
                ws.onerror = function(error) {
                    log('‚ùå Erro no WebSocket: ' + error, 'red');
                };
                
                ws.onclose = function(event) {
                    if (event.code === 1006) {
                        log('‚ùå WebSocket fechado abruptamente (c√≥digo 1006)', 'red');
                        log('üí° Poss√≠vel bloqueio de Mixed Content ou firewall', 'blue');
                    } else {
                        log('WebSocket fechado (c√≥digo: ' + event.code + ')', 'gray');
                    }
                };
                
                // Timeout para detectar problemas
                setTimeout(() => {
                    if (ws.readyState === WebSocket.CONNECTING) {
                        log('‚è∞ Timeout na conex√£o WebSocket', 'red');
                        ws.close();
                    }
                }, 5000);
                
            } catch (error) {
                log('‚ùå Erro ao criar WebSocket: ' + error.message, 'red');
            }
        }

        // Executar testes automaticamente
        window.onload = function() {
            showInfo();
            setTimeout(testMixedContent, 1000);
        };
    </script>
</body>
</html>